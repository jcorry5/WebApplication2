function shapes(n){shape=n}function penSize(n){penWidth=n;document.getElementById("pensize").innerHTML=penWidth}function colourChoice(n){colour=n}var canvas=document.getElementById("anno-canvas"),imageCanvas=document.getElementById("image-canvas"),context=imageCanvas.getContext("2d"),ctx=canvas.getContext("2d"),canvasx,canvasy,last_mousex=last_mousey=0,mousex=mousey=0,mousedown=!1,penWidth=2,colour="black",shape="rect";$(canvas).on("mousedown",function(n){canvasx=$(canvas).offset().left;canvasy=$(canvas).offset().top;last_mousex=parseInt(n.clientX-canvasx);last_mousey=parseInt(n.clientY-76);mousedown=!0});$(canvas).on("mouseup",function(){var u,f,n,t,i,r;mousedown=!1;context.beginPath();context.strokeStyle=colour;context.lineWidth=penWidth;u=mousex-last_mousex;f=mousey-last_mousey;switch(shape){case"rect":context.rect(last_mousex,last_mousey,u,f);context.stroke();break;case"line":context.moveTo(last_mousex,last_mousey);context.lineTo(mousex,mousey);context.stroke();break;case"arrow":context.moveTo(last_mousex,last_mousey);n=10;t=Math.atan2(mousey-last_mousey,mousex-last_mousex);context.lineTo(mousex,mousey);context.lineTo(mousex-n*Math.cos(t-Math.PI/6),mousey-n*Math.sin(t-Math.PI/6));context.moveTo(mousex,mousey);context.lineTo(mousex-n*Math.cos(t+Math.PI/6),mousey-n*Math.sin(t+Math.PI/6));context.stroke();break;case"quad":context.moveTo(last_mousex,last_mousey+(mousey-last_mousey)/2);context.bezierCurveTo(last_mousex,last_mousey,mousex,last_mousey,mousex,last_mousey+(mousey-last_mousey)/2);context.bezierCurveTo(mousex,mousey,last_mousex,mousey,last_mousex,last_mousey+(mousey-last_mousey)/2);context.closePath();context.stroke();i=(mousex-last_mousex)/2+last_mousex;r=(mousey-last_mousey)/2+last_mousey;context.beginPath();context.strokeStyle=colour;context.lineWidth=penWidth;context.moveTo(last_mousex,r);context.lineTo(mousex,r);context.stroke();context.beginPath();context.strokeStyle=colour;context.lineWidth=penWidth;context.moveTo(i,last_mousey);context.lineTo(i,mousey);context.stroke()}ctx.clearRect(0,0,canvas.width,canvas.height)});$(canvas).on("mousemove",function(n){var f,e,t,i,r,u;if(mousex=parseInt(n.clientX-canvasx),mousey=parseInt(n.clientY-76),mousedown){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.beginPath();ctx.strokeStyle=colour;ctx.lineWidth=penWidth;f=mousex-last_mousex;e=mousey-last_mousey;switch(shape){case"rect":ctx.rect(last_mousex,last_mousey,f,e);ctx.stroke();break;case"line":ctx.moveTo(last_mousex,last_mousey);ctx.lineTo(mousex,mousey);ctx.stroke();break;case"arrow":ctx.moveTo(last_mousex,last_mousey);t=10;i=Math.atan2(mousey-last_mousey,mousex-last_mousex);ctx.lineTo(mousex,mousey);ctx.lineTo(mousex-t*Math.cos(i-Math.PI/6),mousey-t*Math.sin(i-Math.PI/6));ctx.moveTo(mousex,mousey);ctx.lineTo(mousex-t*Math.cos(i+Math.PI/6),mousey-t*Math.sin(i+Math.PI/6));ctx.stroke();break;case"quad":ctx.moveTo(last_mousex,last_mousey+(mousey-last_mousey)/2);ctx.bezierCurveTo(last_mousex,last_mousey,mousex,last_mousey,mousex,last_mousey+(mousey-last_mousey)/2);ctx.bezierCurveTo(mousex,mousey,last_mousex,mousey,last_mousex,last_mousey+(mousey-last_mousey)/2);ctx.closePath();ctx.stroke();r=(mousex-last_mousex)/2+last_mousex;u=(mousey-last_mousey)/2+last_mousey;ctx.beginPath();ctx.strokeStyle=colour;ctx.lineWidth=penWidth;ctx.moveTo(last_mousex,u);ctx.lineTo(mousex,u);ctx.stroke();ctx.beginPath();ctx.strokeStyle=colour;ctx.lineWidth=penWidth;ctx.moveTo(r,last_mousey);ctx.lineTo(r,mousey);ctx.stroke()}}});